{"version":3,"sources":["../../../../src/suites/cts/validation/fences.spec.ts"],"names":["description","TestGroup","ValidationTest","g","test","t","fence","queue","createFence","expectValidationError","shouldReject","onCompletion","signal","initialValue","anotherDevice","device","adapter","requestDevice","anotherQueue","getQueue","expect","getCompletedValue"],"mappings":"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","sourcesContent":["export const description = `\nfences validation tests.\n`;\n\nimport { TestGroup } from '../../../framework/index.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nexport const g = new TestGroup(ValidationTest);\n\n// TODO: Remove if https://github.com/gpuweb/gpuweb/issues/377 is decided\ng.test('wait on a fence without signaling the value is invalid', async t => {\n  const fence = t.queue.createFence();\n\n  await t.expectValidationError(() => {\n    t.shouldReject('OperationError', fence.onCompletion(2));\n  });\n});\n\n// TODO: Remove if https://github.com/gpuweb/gpuweb/issues/377 is decided\ng.test('wait on a fence with a value greater than signaled value is invalid', async t => {\n  const fence = t.queue.createFence();\n  t.queue.signal(fence, 2);\n\n  await t.expectValidationError(() => {\n    t.shouldReject('OperationError', fence.onCompletion(3));\n  });\n});\n\ng.test('signal a value lower than signaled value is invalid', async t => {\n  const fence = t.queue.createFence({ initialValue: 1 });\n\n  await t.expectValidationError(() => {\n    t.queue.signal(fence, 0);\n  });\n});\n\ng.test('signal a value equal to signaled value is invalid', async t => {\n  const fence = t.queue.createFence({ initialValue: 1 });\n\n  await t.expectValidationError(() => {\n    t.queue.signal(fence, 1);\n  });\n});\n\ng.test('increasing fence value by more than 1 succeeds', async t => {\n  const fence = t.queue.createFence();\n\n  t.queue.signal(fence, 2);\n  await fence.onCompletion(2);\n\n  t.queue.signal(fence, 6);\n  await fence.onCompletion(6);\n});\n\ng.test('signal a fence on a different device than it was created on is invalid', async t => {\n  const fence = t.queue.createFence();\n\n  const anotherDevice = await t.device.adapter.requestDevice();\n  const anotherQueue = anotherDevice.getQueue();\n\n  await t.expectValidationError(() => {\n    anotherQueue.signal(fence, 2);\n  });\n});\n\ng.test('signal a fence on a different device does not update fence signaled value', async t => {\n  const fence = t.queue.createFence({ initialValue: 1 });\n\n  const anotherDevice = await t.device.adapter.requestDevice();\n  const anotherQueue = anotherDevice.getQueue();\n\n  await t.expectValidationError(() => {\n    anotherQueue.signal(fence, 2);\n  });\n\n  t.expect(fence.getCompletedValue() === 1);\n\n  t.queue.signal(fence, 2);\n  await fence.onCompletion(2);\n});\n"],"file":"fences.spec.js"}