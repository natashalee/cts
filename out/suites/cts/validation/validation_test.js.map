{"version":3,"sources":["../../../../src/suites/cts/validation/validation_test.ts"],"names":["GPUTest","ValidationTest","getErrorBuffer","device","pushErrorScope","errorBuffer","createBuffer","size","usage","popErrorScope","expectValidationError","fn","shouldError","asyncExpectation","gpuValidationError","fail","GPUValidationError","debug","message"],"mappings":";;;;AAAA,SAASA,OAAT,QAAwB,gBAAxB;AAEA,OAAO,MAAMC,cAAN,SAA6BD,OAA7B,CAAqC;AAC1C,QAAME,cAAN,GAA2C;AACzC,SAAKC,MAAL,CAAYC,cAAZ,CAA2B,YAA3B;AACA,UAAMC,WAAW,GAAG,KAAKF,MAAL,CAAYG,YAAZ,CAAyB;AAC3CC,MAAAA,IAAI,EAAE,IADqC;AAE3CC,MAAAA,KAAK,EAAE,MAFoC,CAE5B;;AAF4B,KAAzB,CAApB;AAIA,UAAM,KAAKL,MAAL,CAAYM,aAAZ,EAAN;AACA,WAAOJ,WAAP;AACD;;AAED,QAAMK,qBAAN,CAA4BC,EAA5B,EAA0CC,WAAoB,GAAG,IAAjE,EAAsF;AACpF;AACA,QAAIA,WAAW,KAAK,KAApB,EAA2B;AACzBD,MAAAA,EAAE;AACF;AACD;;AACD,WAAO,KAAKE,gBAAL,CAAsB,YAAY;AACvC,WAAKV,MAAL,CAAYC,cAAZ,CAA2B,YAA3B;AAEAO,MAAAA,EAAE;AAEF,YAAMG,kBAAkB,GAAG,MAAM,KAAKX,MAAL,CAAYM,aAAZ,EAAjC;;AACA,UAAI,CAACK,kBAAL,EAAyB;AACvB,aAAKC,IAAL,CAAU,gCAAV;AACD,OAFD,MAEO,IAAID,kBAAkB,YAAYE,kBAAlC,EAAsD;AAC3D,aAAKC,KAAL,CAAY,+BAA8BH,kBAAkB,CAACI,OAAQ,EAArE;AACD;AACF,KAXM,CAAP;AAYD;;AA7ByC","sourcesContent":["import { GPUTest } from '../gpu_test.js';\n\nexport class ValidationTest extends GPUTest {\n  async getErrorBuffer(): Promise<GPUBuffer> {\n    this.device.pushErrorScope('validation');\n    const errorBuffer = this.device.createBuffer({\n      size: 1024,\n      usage: 0xffff, // Invalid GPUBufferUsage\n    });\n    await this.device.popErrorScope();\n    return errorBuffer;\n  }\n\n  async expectValidationError(fn: Function, shouldError: boolean = true): Promise<void> {\n    // If no error is expected, we let the scope surrounding the test catch it.\n    if (shouldError === false) {\n      fn();\n      return;\n    }\n    return this.asyncExpectation(async () => {\n      this.device.pushErrorScope('validation');\n\n      fn();\n\n      const gpuValidationError = await this.device.popErrorScope();\n      if (!gpuValidationError) {\n        this.fail('Validation error was expected.');\n      } else if (gpuValidationError instanceof GPUValidationError) {\n        this.debug(`Captured validation error - ${gpuValidationError.message}`);\n      }\n    });\n  }\n}\n"],"file":"validation_test.js"}