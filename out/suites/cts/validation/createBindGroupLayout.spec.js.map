{"version":3,"sources":["../../../../src/suites/cts/validation/createBindGroupLayout.spec.ts"],"names":["description","TestGroup","ValidationTest","clone","descriptor","JSON","parse","stringify","g","test","t","goodDescriptor","bindings","binding","visibility","GPUShaderStage","COMPUTE","type","device","createBindGroupLayout","badDescriptor","expectValidationError","NONE","maxDynamicBufferCount","params","maxDynamicBufferBindings","i","push","hasDynamicOffset","length","success","FRAGMENT"],"mappings":"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","sourcesContent":["export const description = `\ncreateBindGroupLayout validation tests.\n`;\n\nimport { TestGroup } from '../../../framework/index.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nfunction clone(descriptor: GPUBindGroupLayoutDescriptor): GPUBindGroupLayoutDescriptor {\n  return JSON.parse(JSON.stringify(descriptor));\n}\n\nexport const g = new TestGroup(ValidationTest);\n\ng.test('some binding index was specified more than once', async t => {\n  const goodDescriptor: GPUBindGroupLayoutDescriptor = {\n    bindings: [\n      {\n        binding: 0,\n        visibility: GPUShaderStage.COMPUTE,\n        type: 'storage-buffer',\n      },\n      {\n        binding: 1,\n        visibility: GPUShaderStage.COMPUTE,\n        type: 'storage-buffer',\n      },\n    ],\n  };\n\n  // Control case\n  t.device.createBindGroupLayout(goodDescriptor);\n\n  const badDescriptor = clone(goodDescriptor);\n  badDescriptor.bindings![1].binding = 0;\n\n  // Binding index 0 can't be specified twice.\n  await t.expectValidationError(() => {\n    t.device.createBindGroupLayout(badDescriptor);\n  });\n});\n\ng.test('negative binding index', async t => {\n  const goodDescriptor: GPUBindGroupLayoutDescriptor = {\n    bindings: [\n      {\n        binding: 0,\n        visibility: GPUShaderStage.COMPUTE,\n        type: 'storage-buffer',\n      },\n    ],\n  };\n\n  // Control case\n  t.device.createBindGroupLayout(goodDescriptor);\n\n  // Negative binding index can't be specified.\n  const badDescriptor = clone(goodDescriptor);\n  badDescriptor.bindings![0].binding = -1;\n\n  await t.expectValidationError(() => {\n    t.device.createBindGroupLayout(badDescriptor);\n  });\n});\n\n// TODO: Update once https://github.com/gpuweb/gpuweb/issues/405 is decided.\ng.test('Visibility of bindings cannot be None', async t => {\n  const goodDescriptor: GPUBindGroupLayoutDescriptor = {\n    bindings: [\n      {\n        binding: 0,\n        visibility: GPUShaderStage.COMPUTE,\n        type: 'storage-buffer',\n      },\n    ],\n  };\n\n  // Control case\n  t.device.createBindGroupLayout(goodDescriptor);\n\n  // Binding visibility set to None can't be specified.\n  const badDescriptor = clone(goodDescriptor);\n  badDescriptor.bindings![0].visibility = GPUShaderStage.NONE;\n\n  await t.expectValidationError(() => {\n    t.device.createBindGroupLayout(badDescriptor);\n  });\n});\n\ng.test('number of dynamic buffers exceeds the maximum value', async t => {\n  const { type, maxDynamicBufferCount } = t.params;\n\n  const maxDynamicBufferBindings: GPUBindGroupLayoutBinding[] = [];\n  for (let i = 0; i < maxDynamicBufferCount; i++) {\n    maxDynamicBufferBindings.push({\n      binding: i,\n      visibility: GPUShaderStage.COMPUTE,\n      type,\n      hasDynamicOffset: true,\n    });\n  }\n\n  const goodDescriptor: GPUBindGroupLayoutDescriptor = {\n    bindings: [\n      ...maxDynamicBufferBindings,\n      {\n        binding: maxDynamicBufferBindings.length,\n        visibility: GPUShaderStage.COMPUTE,\n        type,\n        hasDynamicOffset: false,\n      },\n    ],\n  };\n\n  // Control case\n  t.device.createBindGroupLayout(goodDescriptor);\n\n  // Dynamic buffers exceed maximum in a bind group layout.\n  const badDescriptor = clone(goodDescriptor);\n  badDescriptor.bindings![maxDynamicBufferCount].hasDynamicOffset = true;\n\n  await t.expectValidationError(() => {\n    t.device.createBindGroupLayout(badDescriptor);\n  });\n}).params([\n  { type: 'storage-buffer', maxDynamicBufferCount: 4 },\n  { type: 'uniform-buffer', maxDynamicBufferCount: 8 },\n]);\n\ng.test('dynamic set to true is allowed only for buffers', async t => {\n  const { type, success } = t.params;\n\n  const descriptor = {\n    bindings: [\n      {\n        binding: 0,\n        visibility: GPUShaderStage.FRAGMENT,\n        type,\n        hasDynamicOffset: true,\n      },\n    ],\n  };\n\n  if (success) {\n    // Control case\n    t.device.createBindGroupLayout(descriptor);\n  } else {\n    // Dynamic set to true is not allowed in some cases.\n    await t.expectValidationError(() => {\n      t.device.createBindGroupLayout(descriptor);\n    });\n  }\n}).params([\n  { type: 'uniform-buffer', success: true },\n  { type: 'storage-buffer', success: true },\n  { type: 'readonly-storage-buffer', success: true },\n  { type: 'sampler', success: false },\n  { type: 'sampled-texture', success: false },\n  { type: 'storage-texture', success: false },\n]);\n"],"file":"createBindGroupLayout.spec.js"}